<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEO TACTICS SERIES</title>
    
    <!-- å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (å®‰å®šç‰ˆ) -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/OrbitControls.js"></script>
    
    <!-- ãƒ•ã‚©ãƒ³ãƒˆ & CSS -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&family=Orbitron:wght@700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="common/shared.css">
</head>
<!-- index.html ã®è©²å½“ç®‡æ‰€ã‚’ä¿®æ­£ãƒ»è¿½è¨˜ -->

<body>
    <!-- èƒŒæ™¯ãƒ»HUBãƒœã‚¿ãƒ³ï¼ˆãã®ã¾ã¾ï¼‰ -->
    <div class="bg-grid"></div>
    <a href="https://kkkkk-a.github.io/game-hub/" class="nav-return-btn" title="Game Hub">HUB</a>

    <!-- 1. ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ï¼ˆãã®ã¾ã¾ï¼‰ -->
    <div id="screen-title" class="screen active">
        <div class="panel-glass">
            <h1 style="font-size: 3rem; line-height: 1; margin-bottom: 10px;">MINI<br>GAMES</h1>
            <div style="display:flex; flex-direction:column; gap:10px; align-items:center;">
                <button class="btn" onclick="Core.select('smash')">ã‚¹ãƒãƒƒã‚·ãƒ¥ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼</button>
                <button class="btn" onclick="Core.select('graph')">ã‚°ãƒ©ãƒ•ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ã‚¹</button>
                <button class="btn" onclick="Core.select('line')">ãƒ©ã‚¤ãƒ³ãƒ´ã‚¡ãƒ‹ãƒƒã‚·ãƒ¥</button>
                <button class="btn" onclick="Core.select('calc')">ã‚«ãƒ«ã‚¯ï¼†ã‚¯ãƒ©ãƒƒã‚·ãƒ¥</button>
                <button class="btn" onclick="Core.select('snake')">ã‚¹ãƒãƒ¼ã‚¯ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ã‚¹</button>
            </div>
        </div>
    </div>

    <!-- 2. ãƒ¢ãƒ¼ãƒ‰é¸æŠç”»é¢ï¼ˆãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³è¿½åŠ ï¼‰ -->
    <div id="screen-setup" class="screen">
        <h1 id="setup-title">GAME SETUP</h1>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <button class="btn-mini" onclick="Core.showHelp()" style="background:#444; color:#fff;">ï¼Ÿ ãƒ«ãƒ¼ãƒ«èª¬æ˜</button>
        </div>
        <button class="btn" onclick="Core.start('npc')">ã²ã¨ã‚Š (VS CPU)</button>
        <button class="btn" onclick="Core.start('local')">ãµãŸã‚Š (å¯¾é¢)</button>
        <button class="btn btn-accent" onclick="Shared.UI.show('screen-net')">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦</button>
        <button class="btn" style="border-color:#555; color:#aaa;" onclick="Shared.UI.show('screen-title')">ã‚‚ã©ã‚‹</button>
    </div>

    <!-- 3. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ¥ç¶šç”»é¢ï¼ˆãã®ã¾ã¾ï¼‰ -->
    <div id="screen-net" class="screen">
        <!-- (å†…å®¹ã¯å¤‰æ›´ãªã—) -->
        <h2>NETWORK</h2>
        <div id="net-init" style="display:flex; flex-direction:column; align-items:center;">
            <button class="btn" onclick="Shared.Net.host()">éƒ¨å±‹ã‚’ã¤ãã‚‹ (HOST)</button>
            <button class="btn btn-accent" onclick="Shared.Net.showGuest()">å‚åŠ ã™ã‚‹ (GUEST)</button>
            <button class="btn" style="border-color:#555; color:#aaa;" onclick="Shared.UI.show('screen-setup')">ã‚‚ã©ã‚‹</button>
        </div>
        <!-- ãƒ›ã‚¹ãƒˆ/ã‚²ã‚¹ãƒˆUIçœç•¥ï¼ˆæ—¢å­˜ã®ã¾ã¾ï¼‰ -->
        <div id="net-host-ui" style="display:none; flex-direction:column; align-items:center;">
             <div id="qr-area"></div>
             <div id="host-id-text" class="id-box">---</div>
             <div class="blink" style="color:var(--accent); margin-top:10px;">ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...</div>
             <button class="btn" style="margin-top:20px;" onclick="Core.quitGame()">ä¸­æ­¢</button>
        </div>
        <div id="net-guest-ui" style="display:none; flex-direction:column; align-items:center;">
             <div id="cam-wrapper"></div>
             <button class="btn" onclick="Shared.Net.startCam()">ğŸ“· QRã‚¹ã‚­ãƒ£ãƒ³</button>
             <div style="margin:5px; color:#aaa;">ã¾ãŸã¯</div>
             <input type="text" id="join-id" class="input-code" placeholder="HOST ID">
             <button class="btn btn-accent" onclick="Shared.Net.joinInput()">æ¥ç¶š</button>
             <button class="btn" style="border-color:#555; color:#aaa;" onclick="Core.quitGame()">ã‚‚ã©ã‚‹</button>
        </div>
    </div>

    <!-- 4. ã‚²ãƒ¼ãƒ æœ¬ç·¨ç”»é¢ï¼ˆBACKãƒœã‚¿ãƒ³è¿½åŠ ï¼‰ -->
    <div id="screen-game" class="screen" style="padding:0; background:#000;">
        <div id="game-container">
            <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
            <button id="btn-game-exit" onclick="Core.quitGame()">âœ• EXIT</button>
            
            <canvas id="main-cvs"></canvas>
<div id="turn-display-area" style="position:absolute; top:40px; width:100%; text-align:center; pointer-events:none; z-index:10; display:none;">
    <span style="font-family:'Orbitron'; color:#aaa; text-shadow:0 2px 2px #000; font-size: 0.8rem;">
        TURN <span id="cur-turn">1</span>
    </span>
</div>
            
            <!-- HUDãªã©ã¯æ—¢å­˜ã®ã¾ã¾ -->
            <div class="hud">
                <div id="hud-p2" style="color:var(--accent);">P2: 0</div>
                <div id="hud-center"></div>
                <div id="hud-p1" style="color:var(--primary);">P1: 0</div>
            </div>
            <div id="game-timer" class="game-timer"></div>
            <div id="game-guide" class="guide-msg" style="display:none;"></div>

            <!-- ã‚¹ãƒãƒ›UIãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆæ—¢å­˜ã®ã¾ã¾ï¼‰ -->
            <div class="ui-overlay">
                <!-- (å„ã‚²ãƒ¼ãƒ ã®UIãƒœã‚¿ãƒ³ç¾¤ã¯å¤‰æ›´ãªã—) -->
                <div id="ui-smash" class="touch-group">
                    <div class="ctrl-btn" id="rotL">â†º</div>
                    <div class="ctrl-btn smash" id="charge">è“„</div>
                    <div class="ctrl-btn" id="rotR">â†»</div>
                </div>
                <div id="ui-dpad" class="touch-group">
                    <div class="dpad">
                        <div style="grid-column:2;" class="d-btn" id="up">â–²</div>
                        <div class="d-btn" id="left">â—€</div>
                        <div class="d-btn" id="down">â–¼</div>
                        <div class="d-btn" id="right">â–¶</div>
                    </div>
                </div>
                <div id="ui-rps" class="touch-group">
                    <div class="rps-btn" style="border-color:#ff4444;" id="r">âœŠ</div>
                    <div class="rps-btn" style="border-color:#44ff44;" id="s">âœŒ</div>
                    <div class="rps-btn" style="border-color:#4444ff;" id="p">ğŸ–</div>
                </div>
                <!-- ã‚«ãƒ«ã‚¯ç”¨ãƒ‘ãƒãƒ«ï¼ˆãã®ã¾ã¾ï¼‰ -->
                <div id="ui-calc" class="calc-panel">
                    <div class="calc-header">TARGET: <span id="calc-target" style="color:var(--accent); font-size:2rem;">?</span></div>
                    <div id="calc-disp" class="calc-disp"></div>
                    <div id="calc-chips" class="calc-chips"></div>
                    <div id="calc-hand" class="calc-hand"></div>
                    <div class="calc-btns">
                        <button class="btn-mini" id="c-clear">ã‚¯ãƒªã‚¢</button>
                        <button class="btn-mini" id="c-pass">ãƒ‘ã‚¹</button>
                        <button class="btn-mini accent" id="c-go">æ±ºå®š</button>
                    </div>
                </div>
                <!-- P2ç”¨ D-Pad (ç”»é¢ä¸Šéƒ¨ã«é€†ã•ã¾ã«è¡¨ç¤º) -->
<div id="ui-dpad-p2" class="touch-group" style="position:absolute; top:20px; width:100%; display:none; transform: rotate(180deg);">
    <div class="dpad">
        <div style="grid-column:2;" class="d-btn" id="up2">â–²</div>
        <div class="d-btn" id="left2">â—€</div>
        <div class="d-btn" id="down2">â–¼</div>
        <div class="d-btn" id="right2">â–¶</div>
    </div>
</div>

<!-- P2ç”¨ Smashãƒœã‚¿ãƒ³ (ç”»é¢ä¸Šéƒ¨) -->
<div id="ui-smash-p2" class="touch-group" style="position:absolute; top:20px; width:100%; display:none; transform: rotate(180deg); justify-content: center; gap:20px;">
    <div class="ctrl-btn" id="rotL2">â†º</div>
    <div class="ctrl-btn smash" id="charge2">è“„</div>
    <div class="ctrl-btn" id="rotR2">â†»</div>
</div>
            </div>
        </div>
    </div>

    <!-- 5. çµæœç”»é¢ï¼ˆãƒœã‚¿ãƒ³å¤‰æ›´ï¼‰ -->
    <div id="screen-result" class="screen modal">
        <h1 id="res-title">WIN!</h1>
        <div id="res-detail" style="font-family:'Orbitron'; margin-bottom:20px;"></div>
        <div style="display:flex; gap:10px;">
            <button class="btn" onclick="Core.retry()">RETRY</button>
            <button class="btn" style="border-color:#777;" onclick="Core.quitGame()">MENU</button>
        </div>
    </div>

    <!-- 6. ãƒ˜ãƒ«ãƒ—ç”»é¢ï¼ˆæ–°è¦è¿½åŠ ï¼‰ -->
    <div id="screen-help" class="screen modal" style="z-index: 600;">
        <div class="panel-glass" style="max-width:500px; text-align:left;">
            <h2 id="help-title" style="text-align:center; color:var(--primary);">HELP</h2>
            <div id="help-content" style="white-space: pre-wrap; line-height:1.6; font-size:0.9rem; max-height:60vh; overflow-y:auto; margin-bottom:20px;"></div>
            <div style="text-align:center;">
                <button class="btn-mini" onclick="Core.closeHelp()">ã¨ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- JSèª­ã¿è¾¼ã¿ï¼ˆãã®ã¾ã¾ï¼‰ -->
    <script src="common/shared-sys.js"></script>
    <script src="game/smash-breaker.js"></script>
    <script src="game/graph-tactics.js"></script>
    <script src="game/line-vanish.js"></script>
    <script src="game/calc-crash.js"></script>
    <script src="game/snake-tactics.js"></script>

    <!-- ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¤§å¹…ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼‰ -->
    <script>
const Core = {
        gameId: null,
        currentMode: null, // ãƒªãƒˆãƒ©ã‚¤ç”¨ã«ãƒ¢ãƒ¼ãƒ‰ã‚’è¨˜æ†¶

        // å„ã‚²ãƒ¼ãƒ ã®ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
        helps: {
            'smash': "ã€ã‚¹ãƒãƒƒã‚·ãƒ¥ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼ã€‘\nã‚¼ãƒ³ãƒã‚¤å¼ã®ãƒ”ãƒ³ãƒœãƒ¼ãƒ«å¯¾æˆ¦ã§ã™ã€‚\n\n[æ“ä½œ]\nå›è»¢ãƒœã‚¿ãƒ³: ãƒãƒ¼ã®è§’åº¦èª¿æ•´\nè“„ãƒœã‚¿ãƒ³(é•·æŠ¼ã—): ãƒ‘ãƒ¯ãƒ¼ãƒãƒ£ãƒ¼ã‚¸\næŒ‡ã‚’é›¢ã™: å¼¾ã\n\nãƒœãƒ¼ãƒ«ã‚’ç›¸æ‰‹ã®èƒŒå¾Œã«è½ã¨ã›ã°å‹åˆ©ï¼\nãƒãƒ£ãƒ¼ã‚¸é‡ãŒå¤šã„ã»ã©å¼·ãå¼¾ãã¾ã™ã€‚",
            'graph': "ã€ã‚°ãƒ©ãƒ•ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ã‚¹ã€‘\n3Dç©ºé–“ã§ã®é™£å–ã‚Šã˜ã‚ƒã‚“ã‘ã‚“ã§ã™ã€‚\n\n[ãƒ«ãƒ¼ãƒ«]\nå‹åˆ©: é¸ã‚“ã è»¸æ–¹å‘ã«ã€Œç¾åœ¨ã®å€¤ + 1ã€é€²ã¿ã¾ã™ã€‚\nï¼ˆé ãã¸è¡Œãã»ã©ã€ä¸€æ°—ã«åŠ é€Ÿã—ã¦é€²ã¿ã¾ã™ï¼ï¼‰\n\nã‚ã„ã“: 1ãƒã‚¹æˆ»ã‚Šã¾ã™ã€‚\næ•—åŒ—: é€²ã‚ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«éå»ã®è»Œè·¡ãŒæ­ªã‚€ï¼ˆé ‚ç‚¹ãŒå¢—ãˆã‚‹ï¼‰ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’å—ã‘ã¾ã™ã€‚\n\n[å‹åˆ©æ¡ä»¶]\nç§»å‹•ã—ãŸè»Œè·¡ã¨åŸç‚¹ã§å›²ã¾ã‚ŒãŸã€Œé¢ç©ã€ãŒã‚¹ã‚³ã‚¢ã§ã™ã€‚\nå…ˆã«ã‚¹ã‚³ã‚¢100ã«åˆ°é”ã—ãŸæ–¹ã®å‹åˆ©ã§ã™ã€‚",
            'line': "ã€ãƒ©ã‚¤ãƒ³ãƒ´ã‚¡ãƒ‹ãƒƒã‚·ãƒ¥ã€‘\næ¶ˆãˆã‚‹ä¸‰ç›®ä¸¦ã¹ã§ã™ã€‚\n\n[ãƒ«ãƒ¼ãƒ«]\n3x3ã®ãƒã‚¹ã«äº¤äº’ã«ã‚³ãƒã‚’ç½®ãã¾ã™ã€‚\n3ã¤æƒã†ã¨ç›¸æ‰‹ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼\n\nãŸã ã—ã€Œ4ã¤ç›®ã®ã‚³ãƒã€ã‚’ç½®ãã¨ã€ä¸€ç•ªå¤ã„è‡ªåˆ†ã®ã‚³ãƒãŒæ¶ˆãˆã¾ã™ã€‚\nå¸¸ã«ç›¤é¢ãŒå¤‰åŒ–ã™ã‚‹ä¸­ã§ã€ä¸€ç¬ã®ãƒ“ãƒ³ã‚´ã‚’ç‹™ã„ã¾ã—ã‚‡ã†ã€‚",
            'calc': "ã€ã‚«ãƒ«ã‚¯ï¼†ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã€‘\nè¨ˆç®—å¼ã‚’ä½œã£ã¦ç›¸æ‰‹ã®æ•°å­—ã‚’ç ´å£Šã™ã‚‹ã‚«ãƒ¼ãƒ‰ãƒãƒˆãƒ«ã€‚\n\n[ãƒ«ãƒ¼ãƒ«]\n1. æ•°å­—ã‚«ãƒ¼ãƒ‰ã‚’1æšé¸ã‚“ã§å‡ºã—åˆã„ã¾ã™ã€‚\n2. ç›¸æ‰‹ã®æ•°å­—ã¨ä¸€è‡´ã—ãŸã‚‰ã€ŒCRASHã€ã§å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼\n3. ä¸€è‡´ã—ãªã„å ´åˆã€è‡ªåˆ†ã®æ‰‹æœ­ã¨è¨˜å·(+, -, *, /)ã‚’ä½¿ã£ã¦ã€ç›¸æ‰‹ã®æ•°å­—ã«ãªã‚‹è¨ˆç®—å¼ã‚’ä½œã‚Šã¾ã™ã€‚\n\nè¨ˆç®—æˆåŠŸã§ç›¸æ‰‹ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ã€å¤±æ•—ã§è‡ªåˆ†ãŒãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã¾ã™ã€‚",
            'snake': "ã€ã‚¹ãƒãƒ¼ã‚¯ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ã‚¹ã€‘\nä¼¸ã³ã‚‹è›‡ã‚’æ“ä½œã™ã‚‹ã‚µãƒã‚¤ãƒãƒ«ã‚²ãƒ¼ãƒ ã€‚\n\n[æ“ä½œ]\nåå­—ã‚­ãƒ¼ã¾ãŸã¯ãƒœã‚¿ãƒ³ã§æ–¹å‘è»¢æ›ã€‚\n\n[ãƒ«ãƒ¼ãƒ«]\nå…‰ã‚‹ã‚¨ã‚µã‚’é£Ÿã¹ã‚‹ã¨ä½“ãŒä¼¸ã³ã€ã‚¹ã‚³ã‚¢ã‚¢ãƒƒãƒ—ã€‚\nå£ã‚„è‡ªåˆ†ã€ç›¸æ‰‹ã®ä½“ã«ã¶ã¤ã‹ã‚‹ã¨è² ã‘ã§ã™ã€‚\nç”Ÿãæ®‹ã‚Šã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚"
        },

        // ã‚²ãƒ¼ãƒ é¸æŠ
        select(id) {
            this.gameId = id;
            document.getElementById('setup-title').innerText = id.toUpperCase();
            Shared.UI.show('screen-setup');
        },

        // ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
        showHelp() {
            const text = this.helps[this.gameId] || "èª¬æ˜ãŒã‚ã‚Šã¾ã›ã‚“";
            document.getElementById('help-title').innerText = this.gameId.toUpperCase();
            document.getElementById('help-content').innerText = text;
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            const el = document.getElementById('screen-help');
            el.classList.add('active');
            el.style.display = 'flex';
        },

closeHelp() {
    const el = document.getElementById('screen-help');
    el.classList.remove('active');
    el.style.display = 'none';
    // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ã‚’ç¢ºå®Ÿã«å†è¡¨ç¤º
    document.getElementById('screen-setup').style.display = 'flex';
},

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        start(mode) {
            this.currentMode = mode;
            Shared.Sound.init();
            
            const gameMap = {
                'smash': SmashGame, 'graph': GraphGame, 
                'line': LineGame, 'calc': CalcGame, 'snake': SnakeGame
            };
            const game = gameMap[this.gameId];
            
            if (!game) return alert("Game not found");

            // UIãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.touch-group').forEach(e => e.classList.remove('active'));
            document.getElementById('ui-calc').classList.remove('active');
            
            // æ—¢å­˜ã®çµ‚äº†å‡¦ç†ã‚’å‘¼ã‚“ã§ãŠãï¼ˆå¿µã®ãŸã‚ï¼‰
            if(game.stop) game.stop();

            // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦åˆæœŸåŒ–
            if (mode === 'npc' || mode === 'local') {
                game.init(mode);
            } else if (mode === 'online-host') {
                game.init('online-host');
            } else if (mode === 'online-guest') {
                game.init('online-guest');
            }
        },

        // ã‚²ãƒ¼ãƒ ä¸­æ–­ãƒ»çµ‚äº†å‡¦ç† (Back / Menuãƒœã‚¿ãƒ³ç”¨)
        quitGame() {
            const gameMap = {
                'smash': SmashGame, 'graph': GraphGame, 
                'line': LineGame, 'calc': CalcGame, 'snake': SnakeGame
            };
            const game = gameMap[this.gameId];

            // å„ã‚²ãƒ¼ãƒ ã®åœæ­¢å‡¦ç†ã‚’å®Ÿè¡Œ
            if (game && game.stop) {
                game.stop();
            }

            // é€šä¿¡åˆ‡æ–­
            if (Shared.Net.conn) {
                Shared.Net.conn.close();
                Shared.Net.conn = null;
            }

            // ãƒ¢ãƒ¼ãƒ‰é¸æŠç”»é¢ã«æˆ»ã‚‹ (ã‚¿ã‚¤ãƒˆãƒ«ã§ã¯ãªãã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢)
            Shared.UI.show('screen-setup');
        },

        // ãƒªãƒˆãƒ©ã‚¤å‡¦ç†
        retry() {
            // ç¾åœ¨ã®ã‚²ãƒ¼ãƒ ã‚’åœæ­¢
            const gameMap = {'smash':SmashGame,'graph':GraphGame,'line':LineGame,'calc':CalcGame,'snake':SnakeGame};
            const game = gameMap[this.gameId];
            if(game && game.stop) game.stop();

            // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®å ´åˆã¯å†æ¥ç¶šãŒè¤‡é›‘ãªãŸã‚ã€ä¸€æ—¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã™
            if(this.currentMode && this.currentMode.includes('online')) {
                this.quitGame();
            } else {
                // ãƒ­ãƒ¼ã‚«ãƒ«/NPCãªã‚‰å³å†é–‹
                this.start(this.currentMode);
            }
        }
    };
    </script>
</body>
</html>